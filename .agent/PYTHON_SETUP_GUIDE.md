# ğŸš€ Python Market Simulation - Quick Start Guide

## ğŸ¯ What Was Just Built

A professional-grade market data simulation service that replaces your basic JavaScript price simulator with:

âœ… **Geometric Brownian Motion** (industry-standard price model)  
âœ… **Real OHLC Candles** (Open, High, Low, Close)  
âœ… **Technical Indicators** (RSI, EMA, MACD, Bollinger Bands)  
âœ… **Market Manipulation Support** (synced with admin panel)  
âœ… **Redis Integration** (real-time data streaming)  

## ğŸ“ What Was Created

```
python-market-sim/
â”œâ”€â”€ requirements.txt          # Python dependencies
â”œâ”€â”€ config.py                 # Configuration settings
â”œâ”€â”€ main.py                   # Main service orchestrator
â”œâ”€â”€ .env                      # Environment variables
â”œâ”€â”€ README.md                 # Detailed documentation
â”œâ”€â”€ models/
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”œâ”€â”€ price_engine.py       # GBM price simulation
â”‚   â”œâ”€â”€ candle_generator.py   # OHLC candle aggregation
â”‚   â””â”€â”€ indicators.py         # Technical indicators
â””â”€â”€ publishers/
    â”œâ”€â”€ __init__.py
    â””â”€â”€ redis_publisher.py    # Redis publishing

server/
â””â”€â”€ redis-subscriber.js       # NEW: Receives data from Python
```

## ğŸ”„ Architecture Flow

```
Python Service
     â†“ (generates ticks using GBM)
Redis Pub/Sub
     â†“ (message queue)
Node.js Backend
     â†“ (receives ticks from Redis)
WebSocket
     â†“ (broadcasts to connected clients)
React Frontend
     â†“ (updates charts in real-time)
```

---

## ğŸš€ INSTALLATION & SETUP

### Step 1: Install Redis

**Choose one method:**

#### Option A: Docker (Easiest - Recommended)
```bash
docker run -d -p 6379:6379 --name redis-market redis:latest
```

#### Option B: Windows Native
1. Download from: https://github.com/tporadowski/redis/releases
2. Extract ZIP
3. Run `redis-server.exe`

#### Option C: WSL (Windows Subsystem for Linux)
```bash
wsl --install
wsl
sudo apt-get update
sudo apt-get install redis-server
redis-server &
```

**Verify Redis is running:**
```bash
redis-cli ping
# Should return: PONG
```

---

### Step 2: Set Up Python Environment

```bash
# Navigate to Python service directory
cd "c:\Overview Invest V5\TradingApp\python-market-sim"

# Create virtual environment
python -m venv venv

# Activate virtual environment
venv\Scripts\activate

# Install dependencies
pip install -r requirements.txt
```

**Expected output:**
```
Successfully installed redis-5.0.1 numpy-1.24.3 pandas-2.0.3 ...
```

---

### Step 3: Configure Environment (Already Done!)

The `.env` file is already configured with your database credentials.

---

### Step 4: Test Python Components (Optional)

Before running the full service, test individual components:

```bash
# Test Price Engine
python models/price_engine.py

# Test Candle Generator  
python models/candle_generator.py

# Test Technical Indicators
python models/indicators.py

# Test Redis Publisher (requires Redis running)
python publishers/redis_publisher.py
```

---

## â–¶ï¸ RUNNING THE SYSTEM

You need **4 terminals** running simultaneously:

### Terminal 1: Redis Server âš™ï¸
```bash
# If using Docker:
docker start redis-market

# If using native Redis:
redis-server

# If using WSL:
wsl
redis-server
```

**Keep this running!**

---

### Terminal 2: Python Market Simulation ğŸ
```bash
cd "c:\Overview Invest V5\TradingApp\python-market-sim"
venv\Scripts\activate
python main.py
```

**Expected output:**
```
ğŸš€ Market Simulation Service Initialized
âœ… Connected to Redis at localhost:6379
âœ… Connected to database at aws-...
ğŸ“Š Loading 10 stocks...
   âœ… AAPL   - $  150.00 (volatility: 1.75%)
   âœ… GOOGL  - $  140.00 (volatility: 2.10%)
   ...
ğŸ”„ Starting price generation (interval: 2.0s)
ğŸ“ˆ Tick #0: 10 stocks, avg price: $245.50, manipulated: 0
```

**Keep this running!**

---

### Terminal 3: Node.js Backend ğŸŸ¢
```bash
cd "c:\Overview Invest V5\TradingApp\server"
npm run dev
```

**Expected output:**
```
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
ğŸ”„ SWITCHING TO PYTHON MARKET SIMULATION
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

ğŸ”Œ Connecting to Redis...
âœ… Redis subscriber ready
âœ… Redis subscriber initialized - receiving data from Python

ğŸ’¡ Old JavaScript price simulation is now DISABLED
ğŸ’¡ Prices are now generated by Python service using GBM

ğŸ“¡ Subscribed to Redis channels:
   - price_ticks (live stock prices)
   - candles (OHLC candles)
   - indicators (technical indicators)
   - manipulation_updates (admin actions)

Server running on port 5000
```

**Keep this running!**

---

### Terminal 4: React Frontend âš›ï¸
```bash
cd "c:\Overview Invest V5\TradingApp\client"
npm run dev
```

**Expected output:**
```
  VITE ready in 523 ms
  âœ  Local:   http://localhost:5173/
```

**Keep this running!**

---

## âœ… VERIFICATION CHECKLIST

### 1. Check Redis
```bash
redis-cli
SUBSCRIBE price_ticks
```
You should see JSON messages every 2 seconds with stock prices.

### 2. Check Python Console
Look for:
```
ğŸ“ˆ Tick #10: 10 stocks, avg price: $245.50, manipulated: 0
ğŸ•¯ï¸  Published 1m candle for AAPL to 1 subscriber(s)
```

### 3. Check Node.js Console
Look for:
```
ğŸ“¡ Received 10 ticks from Python, broadcasted to WebSocket
ğŸ•¯ï¸  Completed 1m candle for AAPL: O=150 H=150.5 L=149.8 C=150.2
```

### 4. Check Frontend
1. Open http://localhost:5173
2. Login
3. Click on any stock
4. **Chart should update in real-time!**
5. Prices should change every 2 seconds
6. Candles should form for candlestick charts

---

## ğŸ® TEST MARKET MANIPULATION

### 1. Open Admin Panel
http://localhost:5173/admin

### 2. Create Manipulation
- Select stock: AAPL
- Direction: Force Profit (Pump)
- Duration: 1 minute
- Click "Apply Rule"

### 3. Watch Python Console
```
ğŸ® Manipulation set for AAPL: profit until Thu Dec 12 13:30:00 2025
```

### 4. Watch Stock Price
- AAPL should start climbing steadily
- After 1 minute, it returns to normal volatility

### 5. Python Console shows expiry
```
â° Manipulation expired for AAPL
```

---

## ğŸ› TROUBLESHOOTING

### âŒ "redis.exceptions.ConnectionError"
**Problem:** Redis is not running  
**Solution:**
```bash
# Start Redis
redis-server
# Or: docker start redis-market
```

### âŒ "psycopg2.OperationalError"
**Problem:** Database connection failed  
**Solution:**
- Check `.env` file in `python-market-sim/`
- Verify database credentials
- Test connection: `psql -h [host] -U [user] -d [database]`

### âŒ "No stocks loaded"
**Problem:** Database has no stocks  
**Solution:**
- Make sure you've seeded stocks in database
- Check database: `SELECT * FROM stocks;`

### âŒ "ModuleNotFoundError"
**Problem:** Python packages not installed  
**Solution:**
```bash
cd python-market-sim
venv\Scripts\activate
pip install -r requirements.txt
```

### âŒ Frontend shows old JavaScript prices
**Problem:** Node.js backend not receiving from Redis  
**Check:**
1. Redis is running
2. Python service is running
3. Node.js console shows "Redis subscriber initialized"

### âš ï¸ Chart not updating
**Check:**
1. Browser console for WebSocket connection
2. Network tab for "ws://localhost:5000"
3. Node.js is broadcasting: watch for "priceUpdate" events

---

## ğŸ“Š WHAT'S DIFFERENT NOW

### Before (JavaScript Simulation):
```javascript
// Simple random walk
changePercent = (Math.random() * 0.003) - 0.0015; // Â±0.15%
newPrice = oldPrice * (1 + changePercent);
```

### After (Python GBM):
```python
# Geometric Brownian Motion
shock = np.random.normal(0, 1)
price_change = price * (drift * dt + volatility * sqrt(dt) * shock)
price += price_change
```

**Result:** More realistic, natural-looking price movements!

---

## ğŸ¯ NEXT STEPS (Optional Enhancements)

### 1. Store Candle History
Create table:
```sql
CREATE TABLE candle_history (
    id SERIAL PRIMARY KEY,
    stock_symbol VARCHAR(10),
    interval VARCHAR(10),
    time TIMESTAMP,
    open DECIMAL,
    high DECIMAL,
    low DECIMAL,
    close DECIMAL,
    ticks INTEGER,
    UNIQUE(stock_symbol, interval, time)
);
```

Uncomment `storeCandle()` in `redis-subscriber.js`

### 2. Display Indicators on Frontend
- Receive `indicatorUpdate` events in React
- Show RSI, MACD, Bollinger Bands on chart
- Add buy/sell signals

### 3. Multi-Timeframe Candles
- Update frontend to request different timeframes
- 1-minute, 5-minute, 1-hour charts
- Python service already generates all of these!

### 4. Machine Learning (Advanced)
- Add price prediction model
- Train on historical data
- Display predictions on chart

---

## ğŸ‰ SUCCESS CRITERIA

You know it's working when:

âœ… Python console shows tick generation every 2 seconds  
âœ… Redis is receiving messages (check with `redis-cli`)  
âœ… Node.js console shows "Received X ticks from Python"  
âœ… Frontend charts update in real-time  
âœ… Prices look more natural and realistic  
âœ… Candles form correctly on candlestick charts  
âœ… Market manipulation from admin panel works  

---

## ğŸ“š DOCUMENTATION

- **Python Service:** `python-market-sim/README.md`
- **Implementation Plan:** `.agent/IMPLEMENTATION_PLAN.md`
- **Progress Status:** `.agent/PROGRESS_STATUS.md`
- **Workflow Guide:** `.agent/workflows/build-python-service.md`

---

## ğŸ†˜ GETTING HELP

If something doesn't work:

1. Check all 4 terminals are running
2. Verify Redis: `redis-cli ping`
3. Check Python console for errors
4. Check Node.js console for "Redis subscriber initialized"
5. Check browser console for WebSocket connection
6. Read error messages carefully - they usually tell you exactly what's wrong!

---

## ğŸŠ CONGRATULATIONS!

You've successfully integrated a professional-grade market simulation service into your trading platform!

**Your platform now has:**
- âœ… Industry-standard price modeling (GBM)
- âœ… Real OHLC candles
- âœ… Technical indicators
- âœ… Scalable architecture (Python + Redis + Node.js)
- âœ… Real-time data streaming

**Next recommended step:** Phase 3 - Security Hardening ğŸ”’
